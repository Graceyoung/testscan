{"version":3,"sources":["webpack:///./src/components/SelectFile.vue?4760","webpack:///./src/views/h5/Scan.vue?07cf","webpack:///./src/components/SelectFile.vue?172a","webpack:///src/components/SelectFile.vue","webpack:///./src/components/SelectFile.vue?e4fa","webpack:///./src/components/SelectFile.vue","webpack:///./src/views/h5/Scan.vue","webpack:///./src/views/h5/Scan.vue?33cf","webpack:///./src/views/h5/Scan.vue?44d9"],"names":["render","_vm","this","_h","$createElement","_c","_self","staticClass","attrs","tempFile","on","$event","clickFun","_v","staticStyle","ref","staticRenderFns","class","disabled","_e","handleUpload","accept","multiple","drag","nativeOn","onClick","_t","_s","title","_l","item","index","key","download","name","isShowDel","stopPropagation","removeFile","component","traceCode","$emit","data","beforeAvatarUpload","file","Promise","resolve","img","Image","reader","FileReader","readAsDataURL","onload","e","src","target","result","myCanvas","document","getElementById","myCanvaswd","getContext","drawImage","imageData","getImageData","qrcode","isqrcode","width","height","inversionAttempts","analysisQrcode","console","log","$refs","tip","warning","deep","components","SelectFile"],"mappings":"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","file":"js/chunk-34200202.9a60c1aa.js","sourcesContent":["import mod from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./SelectFile.vue?vue&type=style&index=0&id=6dc2e50e&scoped=true&lang=scss&\"; export default mod; export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./SelectFile.vue?vue&type=style&index=0&id=6dc2e50e&scoped=true&lang=scss&\"","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"module-content\"},[_c('select-file',{attrs:{\"showFileList\":false,\"accept\":\"image/*\",\"outFiles\":_vm.tempFile},on:{\"update:outFiles\":function($event){_vm.tempFile=$event},\"update:out-files\":function($event){_vm.tempFile=$event}}},[_c('span',{on:{\"click\":_vm.clickFun}},[_vm._v(\"相册\")])]),_c('canvas',{staticStyle:{\"display\":\"none\"},attrs:{\"id\":\"myCanvas\",\"width\":\"600\",\"height\":\"600\"}}),_c('tip',{ref:\"tip\"})],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"upload-file\",class:_vm.disabled?'disabled':''},[(!_vm.disabled)?_c('el-upload',{attrs:{\"before-upload\":_vm.handleUpload,\"accept\":_vm.accept,\"multiple\":_vm.multiple,\"drag\":_vm.drag,\"action\":\"//localhost\"},nativeOn:{\"click\":function($event){return _vm.onClick($event)}}},[_vm._t(\"default\",[_c('el-button',{staticClass:\"btn\",attrs:{\"type\":\"primary\",\"icon\":\"ios-link\"}},[_vm._v(_vm._s(_vm.title))])])],2):_vm._e(),(_vm.showFileList)?_c('div',{staticClass:\"file-list\"},_vm._l((_vm.showFileShow),function(item,index){return _c('div',{key:index,staticClass:\"file-item\",on:{\"click\":function($event){return _vm.download(item)}}},[_c('i',{staticClass:\"el-icon-link\"}),_vm._v(\" \"+_vm._s(item.name)+\" \"),(!_vm.disabled&&_vm.isShowDel)?_c('i',{staticClass:\"el-icon-close\",staticStyle:{\"color\":\"#CC0000\"},on:{\"click\":function($event){$event.stopPropagation();return _vm.removeFile(item)}}}):_vm._e()])}),0):_vm._e()],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\r\n    <div class=\"upload-file\" :class=\"disabled?'disabled':''\">\r\n        <el-upload :before-upload=\"handleUpload\"\r\n                   v-if=\"!disabled\"\r\n                   :accept=\"accept\"\r\n                   @click.native=\"onClick\"\r\n                   :multiple=\"multiple\"\r\n                   :drag=\"drag\"\r\n                   action=\"//localhost\">\r\n            <slot>\r\n                <el-button type=\"primary\" icon=\"ios-link\" class=\"btn\">{{ title }}</el-button>\r\n            </slot>\r\n        </el-upload>\r\n        <div class=\"file-list\" v-if=\"showFileList\">\r\n            <div class=\"file-item\" @click=\"download(item)\" v-for=\"(item,index) in showFileShow\" :key=\"index\">\r\n                <i class=\"el-icon-link\"></i>\r\n                {{ item.name }}\r\n                <i class=\"el-icon-close\" @click.stop=\"removeFile(item)\"\r\n                   v-if=\"!disabled&&isShowDel\"\r\n                   style=\"color: #CC0000;\"></i>\r\n            </div>\r\n        </div>\r\n    </div>\r\n\r\n</template>\r\n\r\n<script>\r\n// import {ajaxDownload} from '@/util/apiUtil'\r\n\r\nexport default {\r\n    name: \"selectFile\",\r\n    props: {\r\n        //文字\r\n        title: {\r\n            type: String,\r\n            default: '上传附件'\r\n        },\r\n        //选择的文件类型\r\n        accept: {\r\n            type: String\r\n        },\r\n        showFileList: {\r\n            type: Boolean,\r\n            default: true\r\n        },\r\n        //输出需要上传的文件\r\n        outFiles: [File, Array],\r\n        //需要回显的文件列表 格式:{name:'文件名',path:'路径名'}\r\n        inFiles: {\r\n            type: Array,\r\n            default: () => {\r\n                return []\r\n            }\r\n        },\r\n        //删除的回显文件对象列表\r\n        delInFiles: {\r\n            type: Array,\r\n            default: () => {\r\n                return []\r\n            }\r\n        },\r\n        isDownload: {\r\n            type: Boolean,\r\n            default: true\r\n        },\r\n        //是否多选\r\n        multiple: {\r\n            type: Boolean,\r\n            default: false\r\n        },\r\n        drag: {\r\n            type: Boolean,\r\n            default: false\r\n        },\r\n        isShowDel: {\r\n            type: Boolean,\r\n            default: true\r\n        },\r\n        disabled: Boolean,\r\n        maxSize: {\r\n            type: Number,\r\n            default: null\r\n        },// 文件限制大小，单位kb\r\n        tipDesc: {\r\n            type: String,\r\n            default: null\r\n        },// 提示文字\r\n    },\r\n    data() {\r\n        return {\r\n            //原生File对象\r\n            fileList: []\r\n        }\r\n    },\r\n    computed: {\r\n        //显示的文件列表\r\n        showFileShow() {\r\n            if (!this.multiple && this.fileList.length) {\r\n                return [...this.fileList]\r\n            }\r\n            return [...this.inFiles, ...this.fileList];\r\n        }\r\n    },\r\n    methods: {\r\n        //点击选择文件时清除之前选择的所有文件,不动回显的文件列表\r\n        onClick() {\r\n            if (!this.multiple) {\r\n                this.fileList = [];\r\n            }\r\n        },\r\n        download(file) {\r\n            this.$emit('click-file-name', file);\r\n            if (!this.isDownload) {\r\n                return;\r\n            }\r\n            //todo 选择的文件暂时不支持点击下载\r\n            if (!(file instanceof File)) {\r\n                // ajaxDownload('/file/download', {path: file.path, fileName: file.name + file.suffix})\r\n            }\r\n        },\r\n        removeFile(file) {\r\n            //原生对象直接移除文件列表,不是原生对象添加到移除列表中\r\n            if (file instanceof File) {\r\n                const fileList = this.fileList;\r\n                fileList.splice(fileList.indexOf(file), 1);\r\n            } else {\r\n                const inFiles = this.inFiles;\r\n                inFiles.splice(inFiles.indexOf(file), 1);\r\n                this.delInFiles.push(file);\r\n                this.$emit('update:delInFiles', this.delInFiles);\r\n            }\r\n        },\r\n        handleUpload(file) {\r\n            // 校验上传文件大小，单位kb\r\n            let size = file.size/1024; // kb\r\n            if (this.maxSize && size > this.maxSize){\r\n                console.log(this.tipDesc);\r\n                this.$message({\r\n                    message: this.tipDesc || `照片大小不能超过${this.maxSize/1024}M`,\r\n                    type: 'warning'\r\n                });\r\n                return false;\r\n            }\r\n            //todo 验证文件;\r\n            this.fileList.push(file);\r\n            return false\r\n        },\r\n        clearFiles() {\r\n            this.fileList = [];\r\n        }\r\n    },\r\n    watch: {\r\n        fileList(data) {\r\n            if (this.multiple) {\r\n                this.$emit('update:outFiles', data);\r\n            } else {\r\n                this.$emit('update:outFiles', data[0]);\r\n            }\r\n        }\r\n    }\r\n}\r\n</script>\r\n\r\n<style scoped lang=\"scss\">\r\n\r\n.upload-file {\r\n    > div {\r\n        //line-height: 36px;\r\n        height: 36px;\r\n    }\r\n\r\n    &.disabled {\r\n        .file-list {\r\n            .file-item {\r\n                margin-left: 2rem;\r\n            }\r\n        }\r\n    }\r\n\r\n    .ivu-upload {\r\n        display: inline-block;\r\n    }\r\n\r\n    .file-list {\r\n        display: inline-block;\r\n\r\n        .file-item {\r\n            display: inline-block;\r\n            margin-left: 5rem;\r\n            color: $blue;\r\n            font-size: 1.3rem;\r\n            cursor: pointer;\r\n        }\r\n    }\r\n}\r\n\r\n</style>","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./SelectFile.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./SelectFile.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./SelectFile.vue?vue&type=template&id=6dc2e50e&scoped=true&\"\nimport script from \"./SelectFile.vue?vue&type=script&lang=js&\"\nexport * from \"./SelectFile.vue?vue&type=script&lang=js&\"\nimport style0 from \"./SelectFile.vue?vue&type=style&index=0&id=6dc2e50e&scoped=true&lang=scss&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"6dc2e50e\",\n  null\n  \n)\n\nexport default component.exports","\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nimport {Vue,Component,Watch,Prop} from 'vue-property-decorator';\nimport SelectFile from \"@/components/SelectFile.vue\";\nimport jsqr from \"jsqr\";\nimport tip from './Tip.vue';\n@Component({\n    components:{\n        SelectFile,\n        tip,\n    }\n})\nexport default class Scan extends Vue{\n    $refs!: {\n        tip: tip,\n    }\n    traceCode:any = null;\n    tempFile:any = null;\n\n    clickFun() {\n        this.$emit('on-close');\n    }\n\n    @Watch('tempFile',{\n        deep: true\n    })\n    watchtempFile(data:any) {\n        if(data) {\n            this.beforeAvatarUpload(data);\n        }\n    }\n    analysisQrcode(file:any){\n        return new Promise((resolve)=>{\n            var img = new Image();\n            var reader = new FileReader()\n            reader.readAsDataURL(file);\n            reader.onload = function(e:any) {\n                img.src = e.target.result;\n                var myCanvas:any = document.getElementById('myCanvas');\n                var myCanvaswd = myCanvas.getContext('2d');\n                img.onload = function () {\n                    myCanvaswd.drawImage(img, 0, 0, 600, 600);\n                    var imageData = myCanvaswd.getImageData(0, 0, 600, 600);\n                    let data:any = {\n                        qrcode: '',\n                        isqrcode: true\n                    }\n                    data.qrcode = jsqr(imageData.data, imageData.width, imageData.height, {\n                        inversionAttempts: \"dontInvert\",\n                    });\n                    if (data.qrcode == null){\n                        data.isqrcode = false\n                    }\n                    resolve(data)\n                }\n            }\n        })\n    }\n    //上传成功前的回调\n    async beforeAvatarUpload(file:any) {\n        let data:any = await this.analysisQrcode(file)\n        console.log(data)\n        let traceCode = data.qrcode && data.qrcode.data;\n        if(traceCode !== '' && traceCode != null) {\n            this.$emit('on-scan',traceCode);\n        }else {\n            this.$refs.tip.warning('识别失败，请检查二维码是否正确！');\n        }\n    }\n}\n","import mod from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/ts-loader/index.js??ref--14-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Scan.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/ts-loader/index.js??ref--14-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Scan.vue?vue&type=script&lang=ts&\"","import { render, staticRenderFns } from \"./Scan.vue?vue&type=template&id=361178de&scoped=true&\"\nimport script from \"./Scan.vue?vue&type=script&lang=ts&\"\nexport * from \"./Scan.vue?vue&type=script&lang=ts&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"361178de\",\n  null\n  \n)\n\nexport default component.exports"],"sourceRoot":""}