{"version":3,"sources":["webpack:///./src/views/h5/Scanner.vue?c4f2","webpack:///./src/views/h5/Scanner.vue?9743","webpack:///./src/views/h5/Scanner.vue","webpack:///./src/views/h5/Scanner.vue?def8","webpack:///./src/views/h5/Scanner.vue?2813"],"names":["render","_vm","this","_h","$createElement","_c","_self","staticClass","on","backFun","_v","openMedia","ref","_m","staticRenderFns","timer","result","imgurl","imgurl2","isAnimation","audio","video","cvsele","canvas","mediaStreamTrack","isOpenMedia","Audio","document","createElement","$refs","getContext","$nextTick","media","readyState","HAVE_ENOUGH_DATA","videoWidth","videoHeight","width","height","drawImage","img","getImageData","obj","data","inversionAttempts","location","play","cancelAnimationFrame","console","info","closeMedia","scanSuccess","error","err","requestAnimationFrame","sweep","style","display","navigator","getUserMedia","webkitGetUserMedia","mozGetUserMedia","msGetUserMedia","mediaDevices","facingMode","then","stream","srcObject","setAttribute","addEventListener","catch","name","message","constraint","userAgent","toLowerCase","match","origin","indexOf","tip","warning","trace","$router","push","path","query","traceCode","$emit","getTracks","stop","e","log","components","component"],"mappings":"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","file":"js/chunk-5130c923.a795bd91.js","sourcesContent":["import mod from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Scanner.vue?vue&type=style&index=0&id=ea3be232&scoped=true&lang=scss&\"; export default mod; export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Scanner.vue?vue&type=style&index=0&id=ea3be232&scoped=true&lang=scss&\"","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"wrapper\"},[_c('div',{staticClass:\"header\"},[_c('span',{on:{\"click\":_vm.backFun}},[_vm._v(\"取消\")]),_c('span',{staticClass:\"header-btn color-blue\",on:{\"click\":_vm.openMedia}},[_vm._v(\"扫码\")]),_c('span')]),_c('div',{staticClass:\"canvas-wrap\"},[_c('canvas',{ref:\"canvas\",staticClass:\"canvas\"}),_vm._m(0)]),_c('tip',{ref:\"tip\"})],1)}\nvar staticRenderFns = [function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"bg\"},[_c('div',{staticClass:\"pane\"})])}]\n\nexport { render, staticRenderFns }","\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nimport {Vue,Component,Watch,Prop} from 'vue-property-decorator';\nimport jsQR from \"jsqr\";\n// import scan from './Scan.vue';\nimport tip from './Tip.vue';\n\n@Component({\n    components:{\n        // scan,\n        tip,\n    }\n})\nexport default class Scan extends Vue{\n    $refs!: {\n        canvas:any,\n        tip: tip,\n    }\n    timer:any= null;\n    result:any= \"\";\n    imgurl:any=\n        \"https://raw.githubusercontent.com/MuGuiLin/QRCode/master/VueQRCode/src/assets/github.com.png\";\n    imgurl2:any=\n        \"https://raw.githubusercontent.com/MuGuiLin/QRCode/master/VueQRCode/src/assets/github.com.png\";\n    isAnimation:any= true;\n    audio:any= null;\n    video:any= null;\n    cvsele:any= null;\n    canvas:any= null;\n    mediaStreamTrack:any=null;\n    isOpenMedia:boolean = false;\n\n    mounted() {\n        this.audio = new Audio(\"../assets/tone.mp3\");\n        this.video = document.createElement(\"video\");\n        this.cvsele = this.$refs.canvas;\n        this.canvas = this.cvsele.getContext(\"2d\");\n        this.$nextTick(()=>{\n            this.media();\n        })\n    }\n\n    openMedia() {\n        if(!this.isOpenMedia) {\n            this.media();\n        }\n    }\n\n    sweep() {\n        if (this.video.readyState === this.video.HAVE_ENOUGH_DATA) {\n            const { videoWidth, videoHeight } = this.video;\n            this.cvsele.width = videoWidth;\n            this.cvsele.height = videoHeight;\n            this.canvas.drawImage(this.video, 0, 0, videoWidth, videoHeight);\n            try {\n                const img = this.canvas.getImageData(0, 0, videoWidth, videoHeight);\n                this.imgurl = img;\n                const obj = jsQR(img.data, img.width, img.height, {\n                    inversionAttempts: \"dontInvert\",\n                });\n                if (obj) {\n                    const loc = obj.location;\n                    if (this.result != obj.data) {\n                        this.audio.play();\n                        this.result = obj.data;\n                        this.isAnimation = false;\n                        cancelAnimationFrame(this.timer);\n                        console.info(\"识别结果：\", obj.data);\n                        let result = obj.data;\n                        this.closeMedia();\n                        this.scanSuccess(result);\n                        /*setTimeout(() => {\n                            this.cvsele.style.display = \"none\";\n                        }, 400);*/\n                    }\n                } else {\n                    console.error(\"识别失败，请检查二维码是否正确！\");\n                }\n            } catch (err) {\n                console.error(\"识别失败，请检查二维码是否正确！\", err);\n            }\n        }\n        if (this.isAnimation) {\n            this.timer = requestAnimationFrame(() => {\n                this.sweep();\n            });\n        }\n    }\n\n    media() {\n        this.isAnimation = true;\n        this.cvsele.style.display = \"block\";\n        navigator.getUserMedia =\n            navigator.getUserMedia ||\n            navigator.webkitGetUserMedia ||\n            navigator.mozGetUserMedia ||\n            navigator.msGetUserMedia;\n        // alert(navigator.getUserMedia);\n        if (navigator.mediaDevices) {\n            navigator.mediaDevices\n                .getUserMedia({\n                    video: { facingMode: \"environment\" },\n                })\n                .then((stream) => {\n                    this.isOpenMedia = true;\n                    this.mediaStreamTrack = stream;\n                    this.video.srcObject = stream;\n                    this.video.setAttribute(\"playsinline\", true);\n                    this.video.setAttribute(\"webkit-playsinline\", true);\n                    this.video.addEventListener(\"loadedmetadata\", () => {\n                        this.video.play();\n                        this.sweep();\n                    });\n                })\n                .catch((error:any) => {\n                    console.error(\n                        error.name + \"：\" + error.message + \"，\" + error.constraint\n                    );\n                });\n        } else if (navigator.getUserMedia) {\n            navigator.getUserMedia(\n                {\n                    video: { facingMode: \"environment\" },\n                },\n                (stream) => {\n                    this.isOpenMedia = true;\n                    this.mediaStreamTrack = stream;\n                    this.video.srcObject = stream;\n                    this.video.setAttribute(\"playsinline\", true);\n                    this.video.setAttribute(\"webkit-playsinline\", true);\n                    this.video.addEventListener(\"loadedmetadata\", () => {\n                        this.video.play();\n                        this.sweep();\n                    });\n                },\n                (error:any) => {\n                    console.error(\n                        error.name + \"：\" + error.message + \"，\" + error.constraint\n                    );\n                }\n            );\n        } else {\n            if (\n                navigator.userAgent.toLowerCase().match(/chrome/) &&\n                location.origin.indexOf(\"https://\") < 0\n            ) {\n                console.error(\n                    \"获取浏览器录音功能，因安全性问题，需要在localhost 或 127.0.0.1 或 https 下才能获取权限！\"\n                );\n                this.$refs.tip.warning('获取浏览器录音功能，因安全性问题，需要在localhost 或 127.0.0.1 或 https 下才能获取权限！');\n            } else {\n                this.$refs.tip.warning('对不起：未识别到扫描设备!');\n            }\n        }\n    }\n\n    scanSuccess(trace:any) {\n        this.$router.push({\n            path: '/h5/info',\n            query: {\n                traceCode: trace\n            }\n        })\n    }\n    backFun() {\n        this.closeMedia();\n        this.$emit('backEvent');\n    }\n    closeMedia() {\n        this.audio.play();\n        this.isAnimation = false;\n        cancelAnimationFrame(this.timer);\n        this.isOpenMedia = false;\n        try {\n            this.mediaStreamTrack.getTracks()[0].stop();\n        }catch (e) {\n            console.log(e);\n        }\n    }\n\n}\n","import mod from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/ts-loader/index.js??ref--14-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Scanner.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/ts-loader/index.js??ref--14-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Scanner.vue?vue&type=script&lang=ts&\"","import { render, staticRenderFns } from \"./Scanner.vue?vue&type=template&id=ea3be232&scoped=true&\"\nimport script from \"./Scanner.vue?vue&type=script&lang=ts&\"\nexport * from \"./Scanner.vue?vue&type=script&lang=ts&\"\nimport style0 from \"./Scanner.vue?vue&type=style&index=0&id=ea3be232&scoped=true&lang=scss&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"ea3be232\",\n  null\n  \n)\n\nexport default component.exports"],"sourceRoot":""}