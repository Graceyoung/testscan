{"version":3,"sources":["webpack:///./src/views/h5/Scanner.vue?e45f","webpack:///./src/views/h5/Scanner.vue?3a9e","webpack:///./src/views/h5/Scanner.vue","webpack:///./src/views/h5/Scanner.vue?def8","webpack:///./src/views/h5/Scanner.vue?2813"],"names":["render","_vm","this","_h","$createElement","_c","_self","staticClass","on","backFun","_v","openMedia","closeMedia","scanSuccess","ref","_m","staticRenderFns","timer","result","imgurl","imgurl2","isAnimation","audio","video","cvsele","canvas","mediaStreamTrack","isOpenMedia","Audio","document","createElement","$refs","getContext","$nextTick","draw","media","begin","end","readyState","HAVE_ENOUGH_DATA","videoWidth","videoHeight","width","height","drawImage","img","getImageData","obj","data","inversionAttempts","loc","location","topLeftCorner","topRightCorner","bottomRightCorner","bottomLeftCorner","play","cancelAnimationFrame","console","info","error","err","requestAnimationFrame","sweep","style","display","navigator","getUserMedia","webkitGetUserMedia","mozGetUserMedia","msGetUserMedia","mediaDevices","facingMode","then","stream","srcObject","setAttribute","addEventListener","catch","name","message","constraint","userAgent","toLowerCase","match","origin","indexOf","tip","warning","trace","$router","push","path","query","traceCode","$emit","getTracks","stop","e","log","components","scan","component"],"mappings":"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","file":"js/chunk-567a65fd.22585234.js","sourcesContent":["import mod from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Scanner.vue?vue&type=style&index=0&id=7f8af6fc&scoped=true&lang=scss&\"; export default mod; export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Scanner.vue?vue&type=style&index=0&id=7f8af6fc&scoped=true&lang=scss&\"","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"wrapper\"},[_c('div',{staticClass:\"header\"},[_c('span',{on:{\"click\":_vm.backFun}},[_vm._v(\"取消\")]),_c('span',{staticClass:\"header-btn color-blue\",on:{\"click\":_vm.openMedia}},[_vm._v(\"扫码\")]),_c('scan',{on:{\"on-close\":_vm.closeMedia,\"on-scan\":_vm.scanSuccess}})],1),_c('div',{staticClass:\"canvas-wrap\"},[_c('canvas',{ref:\"canvas\",staticClass:\"canvas\"}),_vm._m(0)]),_c('tip',{ref:\"tip\"})],1)}\nvar staticRenderFns = [function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"bg\"},[_c('div',{staticClass:\"pane\"})])}]\n\nexport { render, staticRenderFns }","\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nimport {Vue,Component,Watch,Prop} from 'vue-property-decorator';\nimport jsQR from \"jsqr\";\nimport scan from './Scan.vue';\nimport tip from './Tip.vue';\n\n@Component({\n    components:{\n        scan,\n        tip,\n    }\n})\nexport default class Scan extends Vue{\n    $refs!: {\n        canvas:any,\n        tip: tip,\n    }\n    timer:any= null;\n    result:any= \"\";\n    imgurl:any=\n        \"https://raw.githubusercontent.com/MuGuiLin/QRCode/master/VueQRCode/src/assets/github.com.png\";\n    imgurl2:any=\n        \"https://raw.githubusercontent.com/MuGuiLin/QRCode/master/VueQRCode/src/assets/github.com.png\";\n    isAnimation:any= true;\n    audio:any= null;\n    video:any= null;\n    cvsele:any= null;\n    canvas:any= null;\n    mediaStreamTrack:any=null;\n    isOpenMedia:boolean = false;\n\n    mounted() {\n        this.audio = new Audio(\"../assets/tone.mp3\");\n        this.video = document.createElement(\"video\");\n        this.cvsele = this.$refs.canvas;\n        this.canvas = this.cvsele.getContext(\"2d\");\n        this.$nextTick(()=>{\n            this.draw();\n            this.media();\n        })\n    }\n\n    openMedia() {\n        if(!this.isOpenMedia) {\n            this.media();\n        }\n    }\n\n    draw(begin?:any, end?:any) {\n        /*this.canvas.beginPath();\n        this.canvas.moveTo(begin.x, begin.y);\n        this.canvas.lineTo(end.x, end.y);\n        this.canvas.lineWidth = 3;\n        this.canvas.strokeStyle = \"red\";\n        this.canvas.stroke();*/\n\n    }\n\n    sweep() {\n        if (this.video.readyState === this.video.HAVE_ENOUGH_DATA) {\n            const { videoWidth, videoHeight } = this.video;\n            this.cvsele.width = videoWidth;\n            this.cvsele.height = videoHeight;\n            this.canvas.drawImage(this.video, 0, 0, videoWidth, videoHeight);\n            try {\n                const img = this.canvas.getImageData(0, 0, videoWidth, videoHeight);\n                this.imgurl = img;\n                const obj = jsQR(img.data, img.width, img.height, {\n                    inversionAttempts: \"dontInvert\",\n                });\n                if (obj) {\n                    const loc = obj.location;\n                    this.draw(loc.topLeftCorner, loc.topRightCorner);\n                    this.draw(loc.topRightCorner, loc.bottomRightCorner);\n                    this.draw(loc.bottomRightCorner, loc.bottomLeftCorner);\n                    this.draw(loc.bottomLeftCorner, loc.topLeftCorner);\n                    if (this.result != obj.data) {\n                        this.audio.play();\n                        this.result = obj.data;\n                        this.isAnimation = false;\n                        cancelAnimationFrame(this.timer);\n                        console.info(\"识别结果：\", obj.data);\n                        let result = obj.data;\n                        this.closeMedia();\n                        this.scanSuccess(result);\n                        /*setTimeout(() => {\n                            this.cvsele.style.display = \"none\";\n                        }, 400);*/\n                    }\n                } else {\n                    console.error(\"识别失败，请检查二维码是否正确！\");\n                }\n            } catch (err) {\n                console.error(\"识别失败，请检查二维码是否正确！\", err);\n            }\n        }\n        if (this.isAnimation) {\n            this.timer = requestAnimationFrame(() => {\n                this.sweep();\n            });\n        }\n    }\n\n    media() {\n        this.isAnimation = true;\n        this.cvsele.style.display = \"block\";\n        navigator.getUserMedia =\n            navigator.getUserMedia ||\n            navigator.webkitGetUserMedia ||\n            navigator.mozGetUserMedia ||\n            navigator.msGetUserMedia;\n        // alert(navigator.getUserMedia);\n        if (navigator.mediaDevices) {\n            navigator.mediaDevices\n                .getUserMedia({\n                    video: { facingMode: \"environment\" },\n                })\n                .then((stream) => {\n                    this.isOpenMedia = true;\n                    this.mediaStreamTrack = stream;\n                    this.video.srcObject = stream;\n                    this.video.setAttribute(\"playsinline\", true);\n                    this.video.setAttribute(\"webkit-playsinline\", true);\n                    this.video.addEventListener(\"loadedmetadata\", () => {\n                        this.video.play();\n                        this.sweep();\n                    });\n                })\n                .catch((error:any) => {\n                    console.error(\n                        error.name + \"：\" + error.message + \"，\" + error.constraint\n                    );\n                });\n        } else if (navigator.getUserMedia) {\n            navigator.getUserMedia(\n                {\n                    video: { facingMode: \"environment\" },\n                },\n                (stream) => {\n                    this.isOpenMedia = true;\n                    this.mediaStreamTrack = stream;\n                    this.video.srcObject = stream;\n                    this.video.setAttribute(\"playsinline\", true);\n                    this.video.setAttribute(\"webkit-playsinline\", true);\n                    this.video.addEventListener(\"loadedmetadata\", () => {\n                        this.video.play();\n                        this.sweep();\n                    });\n                },\n                (error:any) => {\n                    console.error(\n                        error.name + \"：\" + error.message + \"，\" + error.constraint\n                    );\n                }\n            );\n        } else {\n            if (\n                navigator.userAgent.toLowerCase().match(/chrome/) &&\n                location.origin.indexOf(\"https://\") < 0\n            ) {\n                console.error(\n                    \"获取浏览器录音功能，因安全性问题，需要在localhost 或 127.0.0.1 或 https 下才能获取权限！\"\n                );\n                this.$refs.tip.warning('获取浏览器录音功能，因安全性问题，需要在localhost 或 127.0.0.1 或 https 下才能获取权限！');\n            } else {\n                this.$refs.tip.warning('对不起：未识别到扫描设备!');\n            }\n        }\n    }\n\n    scanSuccess(trace:any) {\n        this.$router.push({\n            path: '/h5/info',\n            query: {\n                traceCode: trace\n            }\n        })\n    }\n    backFun() {\n        this.closeMedia();\n        this.$emit('backEvent');\n    }\n    closeMedia() {\n        this.audio.play();\n        this.isAnimation = false;\n        cancelAnimationFrame(this.timer);\n        this.isOpenMedia = false;\n        try {\n            this.mediaStreamTrack.getTracks()[0].stop();\n        }catch (e) {\n            console.log(e);\n        }\n    }\n\n}\n","import mod from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/ts-loader/index.js??ref--14-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Scanner.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/ts-loader/index.js??ref--14-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Scanner.vue?vue&type=script&lang=ts&\"","import { render, staticRenderFns } from \"./Scanner.vue?vue&type=template&id=7f8af6fc&scoped=true&\"\nimport script from \"./Scanner.vue?vue&type=script&lang=ts&\"\nexport * from \"./Scanner.vue?vue&type=script&lang=ts&\"\nimport style0 from \"./Scanner.vue?vue&type=style&index=0&id=7f8af6fc&scoped=true&lang=scss&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"7f8af6fc\",\n  null\n  \n)\n\nexport default component.exports"],"sourceRoot":""}